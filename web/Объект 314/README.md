# Объект 314

## Условия

Говорят, каждый ученик втайне мечтает взломать сайт школы...

[http://5.1.53.43:5008/](http://5.1.53.43:5008/)

## Выдать участникам

Ничего

## Решение

На сайте присутствует функционал входа в аккаунт. Причем сначала при входе проверяется существование пользователя, а только потом пароль. Таким образом можно узнать, что пользователь admin существует, и к нему подходит пароль admin. Но требуется код двухфакторной аутентификации...

Зарегистрировав аккаунт, можно получить QR-код для добавления кода двухфакторной аутентификации в приложение-аутентификатор. Если отсканировать его при помощи камеры смартфона или специального приложения, можно получить ссылку такого вида:

```
otpauth://totp/user?secret=OVZWK4S7NYYF633OGNPXOMLMNRPTG5RTOJPTS5JTONZQ
```

Раскодировав значение параметра secret как base32, получаем:

```
user_n0_on3_w1ll_3v3r_9u3ss
```

Текст после имени пользователя выглядит осмысленным, что наталкивает на вывод о том, что секрет аутентификатора генерируется по статичному шаблону: `<имя пользователя>_n0_on3_w1ll_3v3r_9u3ss`

Заменив имя пользователя на admin и снова закодировав строку в base32, получаем ссылку:

```
otpauth://totp/admin?secret=MFSG22LOL5XDAX3PNYZV65ZRNRWF6M3WGNZF6OLVGNZXG
```

Сгенерировав QR-код при помощи онлайн-сервиса, добавляем код аутентификации в приложение и успешно входим под аккаунтом admin.

Окинув сайт внимательным взглядом, замечаем, что в панели навигации слева появилась привлекательная ссылка "Установить защищенное подключение", после нажатия которой открывается онлайн-терминал с подключением к консоли сервера.

В корне файловой системы находится папка `blackshift`, содержащая внутренние документы организации. В одном из них есть указание на то, что на сервере работает база данных PostgreSQL:

```
...
[10:42:35] ivan.chernov: логин: headmaster, база: blackshift_core
[10:42:39] ivan.chernov: пароль тот же, с 2023 года))
...
```

Подключаемся к базе данных:

```
psql --dbname blackshift_core
```

Введя команду `\dt`, получаем список таблиц базы данных: `students` и `students_anomalies`. Запрашиваем все записи из второй таблицы:

```
SELECT * FROM students_anomalies;
```

В одной из них находится флаг.

## Флаг

```
TyumenCTF{d0nT_tru5t_7he_h34dm4st3r}
```
